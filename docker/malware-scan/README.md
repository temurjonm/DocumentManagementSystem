# Malware Scan Worker

This Docker container runs a malware scanning worker using ClamAV. It polls an SQS queue for scan requests, downloads files from S3, scans them, and reports results back to Step Functions.

## Building

```bash
docker build -f docker/malware-scan/Dockerfile -t dms-malware-scan:latest .
```

## Running Locally

```bash
docker run -e QUEUE_URL=<queue-url> \
           -e S3_BUCKET=<bucket-name> \
           -e AWS_REGION=us-east-1 \
           -e AWS_ACCESS_KEY_ID=<key> \
           -e AWS_SECRET_ACCESS_KEY=<secret> \
           dms-malware-scan:latest
```

## Deployment

The container is deployed to ECS Fargate via Terraform. See `terraform/modules/malware-scan/` for infrastructure configuration.

## How It Works

1. Worker polls SQS queue for scan messages
2. Downloads file from S3 to `/tmp`
3. Runs ClamAV scan on the file
4. Reports success/failure back to Step Functions via task token
5. Deletes message from queue and cleans up temp file

## Configuration

- `QUEUE_URL`: SQS queue URL to poll
- `S3_BUCKET`: S3 bucket containing documents
- `AWS_REGION`: AWS region
- Visibility timeout: 60 minutes (for large files)
- Max retries: 5 (configured in SQS)
